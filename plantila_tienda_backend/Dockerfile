FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /src

ARG ARG_API_PORT
ARG ARG_IP_FRONT
ARG ARG_DB_HOST
ARG ARG_DB_PORT
ARG ARG_DB_USER
ARG ARG_DB_PASSWORD
ARG ARG_DB_NAME
ARG ARG_MONGO_AUTH_DB
ARG ARG_JWT_SECRET
ARG ARG_JWT_AUDIENCE
ARG ARG_JWT_ISSUER
ARG ARG_JWT_EXPIRATION
ARG ARG_APP_NAME
ARG ARG_APP_VERSION

ENV DB_HOST=${ARG_DB_HOST}
ENV DB_PORT=${ARG_DB_PORT}
ENV DB_USER=${ARG_DB_USER}
ENV DB_PASSWORD=${ARG_DB_PASSWORD}
ENV DB_NAME=${ARG_DB_NAME}
ENV MONGO_AUTH_DB=${ARG_MONGO_AUTH_DB}
ENV IP_FRONT=${ARG_IP_FRONT}
ENV API_PORT=${ARG_API_PORT}
ENV JWT_SECRET=${ARG_JWT_SECRET}
ENV JWT_AUDIENCE=${ARG_JWT_AUDIENCE}
ENV JWT_ISSUER=${ARG_JWT_ISSUER}
ENV JWT_EXPIRATION=${ARG_JWT_EXPIRATION}
ENV APP_NAME=${ARG_APP_NAME}
ENV APP_VERSION=${ARG_APP_VERSION}


COPY ["plantilla_tienda_backend.csproj", "./"]
RUN dotnet restore "./plantilla_tienda_backend.csproj"

COPY . .
RUN dotnet publish "./plantilla_tienda_backend.csproj" -c Release -o /app

FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS runtime
WORKDIR /app
COPY --from=build /app ./

ENV ASPNETCORE_URLS=http://+:5000

EXPOSE 5000
ENTRYPOINT ["dotnet", "plantilla_tienda_backend.dll"]
